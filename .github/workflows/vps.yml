name: VPS Ubuntu Free

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Cài tmate
      run: |
        sudo apt-get update
        sudo apt-get install -y tmate

    - name: Tạo VPS qua tmate
      run: |
        # tạo session chạy ngầm
        tmate -S /tmp/tmate.sock new-session -d
        # đợi session sẵn sàng
        tmate -S /tmp/tmate.sock wait tmate-ready
        # in ra SSH + Web URL để kết nối
        echo "===== SSH command ====="
        tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}'
        echo "===== Web URL ====="
        tmate -S /tmp/tmate.sock display -p '#{tmate_web}'
        # giữ VPS chạy vô hạn (max 6h cho free)
        sleep infinity
